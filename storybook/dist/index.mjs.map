{"version":3,"sources":["../src/utils/twig.ts"],"names":["XMLParser","TwigTemplate","source","components","parseSubComponents","reservedNames","tagRe","functionRe","documentObj","lookupComponents","obj","names","key","value","m","name","twig","values","rawSource"],"mappings":"AAAA,OAAS,aAAAA,MAAiB,kBAEnB,IAAMC,EAAN,KAAmB,CACtB,YACqBC,EACAC,EACnB,CAFmB,YAAAD,EACA,gBAAAC,EAEjB,KAAK,OAASD,CAClB,CAEA,WAAY,CACR,OAAO,KAAK,MAChB,CAEA,UAAmB,CACf,OAAO,KAAK,MAChB,CAEA,eAA0B,CACtB,OAAO,KAAK,UAChB,CACJ,EAEA,SAASE,EAAmBF,EAAgB,CACxC,IAAMG,EAAgB,CAAC,OAAO,EACxBC,EAAQ,IAAI,OAAO,+BAA+B,EAClDC,EAAa,IAAI,OAAO,0DAA2D,IAAI,EAGvFC,EAAc,IAAIR,EAAU,EAAE,MAAM,QAAQE,CAAM,QAAQ,EAC1DO,EAAoBC,GACf,OAAO,QAAQA,CAAG,EAAE,OAAO,CAACC,EAAO,CAACC,EAAKC,CAAK,IAAM,CACvD,GAAIA,IAAU,MAAQ,OAAOA,GAAU,SACnCF,EAAM,KAAK,GAAGF,EAAiBI,CAAK,CAAC,UAC9B,OAAOA,GAAU,SACxB,QAAWC,KAAKD,EAAM,SAASN,CAAU,EACrCI,EAAM,KAAK,CAAC,GAAGG,CAAC,EAAE,CAAC,CAAC,EAG5B,OAAIR,EAAM,KAAKM,CAAG,GACdD,EAAM,KAAKC,EAAI,QAAQ,QAAS,EAAE,CAAC,EAEhCD,CACX,EAAG,CAAC,CAAC,EAGT,OAAOF,EAAiBD,CAAW,EAAE,OAAQO,GAAS,CAACV,EAAc,SAASU,CAAI,CAAC,CACvF,CAEO,SAASC,EAAKd,KAAiCe,EAA6B,CAC/E,IAAMC,EAAY,OAAO,IAAI,CAAE,IAAKhB,CAAO,EAAG,GAAGe,CAAM,EACvD,OAAO,IAAIhB,EAAaiB,EAAWd,EAAmBc,CAAS,CAAC,CACpE","sourcesContent":["import { XMLParser } from 'fast-xml-parser';\n\nexport class TwigTemplate {\n    constructor(\n        private readonly source: string,\n        private readonly components: string[]\n    ) {\n        this.source = source;\n    }\n\n    getSource() {\n        return this.source;\n    }\n\n    toString(): string {\n        return this.source;\n    }\n\n    getComponents(): string[] {\n        return this.components;\n    }\n}\n\nfunction parseSubComponents(source: string) {\n    const reservedNames = ['block'];\n    const tagRe = new RegExp(/twig:[A-Za-z]+(?::[A-Za-z]+)*/);\n    const functionRe = new RegExp(/component\\(\\s*'([A-Za-z]+(?::[A-Za-z]+)*)'\\s*(?:,.*)?\\)/, 'gs');\n\n    // Dummy div tag to handle templates without any tag\n    const documentObj = new XMLParser().parse(`<div>${source}</div>`);\n    const lookupComponents = (obj: { [p: string]: any }): string[] => {\n        return Object.entries(obj).reduce((names, [key, value]) => {\n            if (value !== null && typeof value === 'object') {\n                names.push(...lookupComponents(value));\n            } else if (typeof value === 'string') {\n                for (const m of value.matchAll(functionRe)) {\n                    names.push([...m][1]);\n                }\n            }\n            if (tagRe.test(key)) {\n                names.push(key.replace('twig:', ''));\n            }\n            return names;\n        }, []);\n    };\n\n    return lookupComponents(documentObj).filter((name) => !reservedNames.includes(name));\n}\n\nexport function twig(source: TemplateStringsArray, ...values: any[]): TwigTemplate {\n    const rawSource = String.raw({ raw: source }, ...values);\n    return new TwigTemplate(rawSource, parseSubComponents(rawSource));\n}\n"]}